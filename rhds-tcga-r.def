Bootstrap: docker
From: rocker/r-ver:4.5.2

%files
    install.r

%post    
    # install curl and python
    apt-get update && \
    apt-get install -y libcurl4-openssl-dev curl python3 python3-pip libzmq3-dev

    # install quarto
    QUARTO_VERSION=1.6.42
    QUARTO_URL=https://github.com/quarto-dev/quarto-cli/releases/download/v${QUARTO_VERSION}/quarto-${QUARTO_VERSION}-linux-amd64.deb
    curl -o quarto-linux-amd64.deb -L ${QUARTO_URL} && \
        DEBIAN_FRONTEND=noninteractive apt-get install -f -y ./quarto-linux-amd64.deb && \
        rm quarto-linux-amd64.deb

    # install jupyter
    pip3 install --break-system-packages --no-cache-dir jupyter jupyterlab

    # install R packages (including IRkernel) and register kernel
    mkdir -p /opt/jupyter
    JUPYTER_DATA_DIR=/opt/jupyter Rscript install.r

%environment
    export LC_ALL=C
    export JUPYTER_DATA_DIR=/opt/jupyter

%runscript
    echo "Arguments received: $*"
    exec "$@"
    
%help
    Runs R scripts in the rhds-tcga analysis.

